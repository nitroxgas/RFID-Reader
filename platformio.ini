; ============================================
; RFID Reader + Display CYD - Dual ESP32
; Projeto modular com Reader e Display separados
; ============================================

[platformio]
default_envs = reader-wroom
description = Sistema RFID com Display CYD (Arquitetura Dual ESP32)

; ============================================
; READER: ESP32-WROOM (RFID)
; ============================================
[env:reader-wroom]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Filtra para incluir apenas código do reader
build_src_filter = 
    +<reader/>
    +<common/>
    -<display/>

; Bibliotecas para RFID
lib_deps = 
    miguelbalboa/MFRC522 @ ^1.4.12

; Flags de compilação
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_ESP32_WROOM=1
    -I src/common
    
    ; Pinos MFRC522
    -DSS_PIN=5
    -DRST_PIN=22
    -DSCK_PIN=18
    -DMISO_PIN=19
    -DMOSI_PIN=23
    
    ; Pinos UART para Display
    -DUART1_TX_PIN=17
    -DUART1_RX_PIN=16

; Porta serial (ajuste conforme necessário)
; upload_port = COM4
; monitor_port = COM4

; ============================================
; READER: ESP32-S3-LCD (Legacy - Waveshare)
; Alternativa com ESP32-S3 + Display integrado
; ============================================
[env:reader-s3lcd]
platform = espressif32
framework = arduino
board = esp32-s3-devkitc-1
monitor_speed = 115200
upload_speed = 921600

; Filtra para incluir apenas código do reader
build_src_filter = 
    +<reader/>
    +<common/>
    -<display/>

; Bibliotecas para RFID
lib_deps = 
    miguelbalboa/MFRC522 @ ^1.4.12

; Flags de compilação
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_ESP32S3_LCD=1
    -I src/common
    
    ; Pinos MFRC522 (soldagem necessária)
    -DSS_PIN=3
    -DRST_PIN=0
    -DSCK_PIN=4
    -DMISO_PIN=42
    -DMOSI_PIN=5

board_build.flash_mode = qio
board_build.f_flash = 80000000L
board_build.f_cpu = 240000000L
board_build.partitions = default_16MB.csv

; Porta serial (ajuste conforme necessário)
; upload_port = COM6
; monitor_port = COM6

; ============================================
; DISPLAY: ESP32-2432S028R (CYD)
; Display LVGL + recebe dados via UART
; ============================================
[env:display-cyd]
platform = espressif32
framework = arduino
board = esp32dev
monitor_speed = 115200
upload_speed = 921600
upload_port = COM37
monitor_port = COM37

; Filtra para incluir apenas código do display
build_src_filter = 
    +<display/>
    +<common/>
    -<reader/>

; Modo de busca de bibliotecas
lib_ldf_mode = deep+

; Bibliotecas para Display + LVGL + Touch
lib_deps = 
    bodmer/TFT_eSPI @ ^2.5.31
    lvgl/lvgl @ ^8.4.0
    paulstoffregen/XPT2046_Touchscreen @ ^1.4

; Flags de compilação
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_ESP32_CYD=1
    -I src/common
    -I lib
    -I include
    -I display/ui
    -I display/ui/screens
    -I display/ui/components
    
    ; LVGL Configuration
    -DLV_CONF_INCLUDE_SIMPLE
    -DLV_CONF_SKIP_EXAMPLES=1
    
    ; TFT_eSPI Configuration (ESP32-2432S028R - CYD LANDSCAPE)
    -DUSER_SETUP_LOADED=1
    -DILI9341_2_DRIVER=1
    -DTFT_WIDTH=240
    -DTFT_HEIGHT=320
    -DTFT_MOSI=13
    -DTFT_MISO=12
    -DTFT_SCLK=14
    -DTFT_CS=15
    -DTFT_DC=2
    -DTFT_RST=12
    -DTFT_BL=21
    -DTFT_BACKLIGHT_ON=HIGH
    
    ; Touch
    -DTOUCH_CS=33
    -DTOUCH_CLK=25
    -DTOUCH_MISO=39
    -DTOUCH_MOSI=32
    -DTOUCH_IRQ=36
    
    ; Fonts
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DLOAD_GFXFF=1
    -DSMOOTH_FONT=1
    
    ; SPI Frequency
    -DSPI_FREQUENCY=55000000
    -DSPI_READ_FREQUENCY=20000000
    -DSPI_TOUCH_FREQUENCY=2500000
    
    ; Pinos UART (conecta ao Reader)
    -DUART_RX_PIN=27
    -DUART_TX_PIN=22
    
    ; LVGL Additional Config
    -DLV_COLOR_DEPTH=16
    -DLV_COLOR_16_SWAP=0
    -DLV_MEM_SIZE='(64U * 1024U)'
    -DLV_USE_LOG=1
    -DLV_LOG_LEVEL=LV_LOG_LEVEL_WARN

; Porta serial configurada:
; display-cyd: COM37 (ESP32-2432S028R)
; reader-wroom: COM5 (ajustar conforme necessário)

; ============================================
; NOTAS DE USO
; ============================================
;
; Para compilar e gravar no READER (ESP32-WROOM):
;   pio run -e reader-wroom --target upload
;   pio device monitor -e reader-wroom
;
; Para compilar e gravar no DISPLAY (CYD):
;   pio run -e display-cyd --target upload
;   pio device monitor -e display-cyd
;
; Para compilar ambos:
;   pio run
;
; Via VS Code:
;   1. Clique no ícone PlatformIO na barra lateral
;   2. Expanda o ambiente desejado (reader-wroom ou display-cyd)
;   3. Clique em "Upload" ou "Upload and Monitor"
;
; Alternando entre ambientes na UI do VS Code:
;   1. Clique na barra de status inferior (Project Tasks)
;   2. Selecione o ambiente desejado
;   3. O ambiente selecionado aparecerá destacado
;
; ============================================
